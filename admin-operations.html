<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hope Raid Tracker - Admin Requests & Audit</title>
  <link rel="icon" type="image/webp" href="assets/images/alliance-img.webp" />
  <link rel="apple-touch-icon" href="assets/images/alliance-img.webp" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="admin-operations-page">
  <section id="authGate" class="auth-gate">
    <div class="auth-gate-card">
      <h1>Hope Raid Tracker</h1>
      <p id="authGateMessage" class="auth-gate-message">Sign in with Google to continue.</p>
      <button type="button" id="authGateSignInButton">Sign in with Google</button>
    </div>
  </section>

  <main class="container" id="appShell" hidden>
    <header class="header">
      <nav class="top-nav" aria-label="Primary navigation">
        <div class="nav-actions">
          <a class="nav-button" href="index.html">Signup Page</a>
          <a class="nav-button" href="admin.html">Admin: Raids</a>
          <a id="adminOpsLink" class="nav-button" href="admin-operations.html">
            Admin: Requests &amp; Audit
            <span id="adminOpsBadge" class="nav-mini-badge" hidden>0</span>
          </a>
          <a
            id="guildDiscordLink"
            class="nav-button discord-button"
            href="https://discord.gg/xYtxu6Yj"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Guild Discord"
            title="Guild Discord"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M19.54 4.53A16.86 16.86 0 0 0 15.49 3c-.18.32-.4.75-.55 1.09a15.58 15.58 0 0 0-5.88 0c-.16-.34-.37-.77-.56-1.09a16.79 16.79 0 0 0-4.06 1.54C1.92 8.38 1.24 12.14 1.58 15.85A17 17 0 0 0 6.56 18.4c.4-.55.76-1.14 1.06-1.76a10.95 10.95 0 0 1-1.67-.8c.14-.1.28-.22.42-.33a12.03 12.03 0 0 0 11.25 0c.14.12.28.23.42.33-.53.31-1.09.58-1.68.8.31.62.66 1.21 1.06 1.76a16.94 16.94 0 0 0 4.99-2.55c.4-4.3-.68-8.02-2.87-11.32ZM8.96 13.58c-.9 0-1.63-.82-1.63-1.84 0-1.01.72-1.84 1.63-1.84.91 0 1.64.83 1.63 1.84 0 1.02-.72 1.84-1.63 1.84Zm6.08 0c-.9 0-1.63-.82-1.63-1.84 0-1.01.72-1.84 1.63-1.84.91 0 1.64.83 1.63 1.84 0 1.02-.72 1.84-1.63 1.84Z"/>
            </svg>
            Discord
          </a>
        </div>
      </nav>
      <div class="brand">
        <img class="brand-icon" src="assets/images/alliance-img.webp" alt="Alliance crest" />
        <h1 id="siteTitle">Hope Raid Tracker - Admin Requests &amp; Audit</h1>
      </div>
      <p id="adminAuthStatus" class="auth-status">Connecting...</p>
      <div class="auth-meta">
        <span id="currentUid" class="uid-chip" hidden></span>
        <button type="button" id="copyUidButton" class="secondary" hidden>Copy UID</button>
      </div>
      <div class="auth-actions">
        <button type="button" id="signOutButton" class="secondary" hidden>Sign Out</button>
      </div>
    </header>

    <section class="card" id="signupRequestsSection" hidden>
      <div class="list-header">
        <h2>Signup Requests</h2>
        <span id="signupRequestBadge" class="badge">0</span>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Raid Date</th>
              <th>Raid</th>
              <th>Profile</th>
              <th>Character</th>
              <th>Class</th>
              <th>Spec</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="signupRequestRows"></tbody>
        </table>
      </div>
      <p id="signupRequestMessage" class="message"></p>
    </section>

    <section class="card" id="characterAuditSection" hidden>
      <div class="list-header">
        <h2>Character Audit</h2>
        <span id="auditCountBadge" class="badge">0</span>
      </div>

      <div class="audit-filters">
        <label>
          Search
          <input id="auditSearch" type="text" placeholder="Search profile, character, class, role, spec" />
        </label>

        <label>
          Class
          <select id="auditClassFilter">
            <option value="">All Classes</option>
          </select>
        </label>

        <label>
          Activity
          <select id="auditActivityFilter">
            <option value="all">All</option>
            <option value="has-signups">Has signup history</option>
            <option value="no-signups">No signup history</option>
            <option value="past-accepted">Has past accepted raid</option>
          </select>
        </label>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Profile</th>
              <th>Character</th>
              <th>Class</th>
              <th>MS</th>
              <th>OS</th>
              <th>Gear</th>
              <th class="audit-history-col">History</th>
              <th>Last Raid</th>
            </tr>
          </thead>
          <tbody id="characterAuditRows"></tbody>
        </table>
      </div>
      <p id="characterAuditMessage" class="message"></p>
    </section>

    <section class="card" id="accessManagerSection" hidden>
      <div class="list-header">
        <h2>Access Manager</h2>
      </div>

      <form id="accessForm" class="access-form">
        <label>
          User UID
          <input id="accessUidInput" type="text" placeholder="Firebase Auth UID" required />
        </label>

        <label>
          Access Type
          <select id="accessTypeSelect">
            <option value="member">Member</option>
            <option value="admin">Admin</option>
          </select>
        </label>

        <button type="submit" id="accessAddButton">Grant Access</button>
      </form>

      <p id="accessManagerMessage" class="message"></p>

      <div class="access-grid">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th colspan="2">Admins</th>
              </tr>
            </thead>
            <tbody id="adminAccessRows"></tbody>
          </table>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th colspan="2">Members</th>
              </tr>
            </thead>
            <tbody id="memberAccessRows"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <script>
    if (location.hostname === "localhost" || location.hostname === "127.0.0.1") {
      const script = document.createElement("script");
      script.src = "config/local/app-config.local.js";
      document.head.appendChild(script);
    }
  </script>
  <script src="config/prod/app-config.github.js"></script>
  <script type="module" src="admin-operations.js"></script>
</body>
</html>
